stages:
  - run
  - documentation

#############
# Run tests #
#############
run_test:
  stage: run
  tags:
    - docker
  script:
    - source .gitlab-ci.d/init_python3.sh
    - pip3 install --user pandas
    - pip3 install --user matplotlib
    - pip3 install --user IPython
    - yum -y install tk
    - source .gitlab-ci.d/disable_Xserver.sh
    - cd analysis
    - python3 plot_data.py
  artifacts:
    paths:
      - analysis/fig/
    expire_in: 1 hour

#################
# Documentation #
#################

presentation:
  stage: documentation
  tags:
    - docker
  dependencies:
    - run_test
  image: clicdp/fedora-latex
  script:
    - cd doc
    - pdflatex -interaction=nonstopmode presentation.tex
    - pdflatex -interaction=nonstopmode presentation.tex
  artifacts:
    paths:
      - "*.pdf"
    expire_in: 1 hour
